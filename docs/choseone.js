var TouchManager,colors,i,ref,results;colors=[[239,247,7],[52,219,2],[35,35,237],[209,29,29],[199,54,247],[247,159,7],[29,242,242],[252,40,171],[255,255,255],[136,136,136]];TouchManager={data:{state:{},pos:[],availableColorIndexes:function(){results=[];for(var i=0,ref=colors.length;0<=ref?i<ref:i>ref;0<=ref?i++:i--){results.push(i)}return results}.apply(this),bgColor:[7,30,3],bgColor:[0,0,0],evtCountMax:3,width:50,sounds:{ting:new Howl({src:["sound/237105__sqeeeek__sqeeeek-bell-ting2.wav"]}),tong:new Howl({src:["sound/237106__sqeeeek__sqeeeek-bell-ting1.wav"]}),dzang:new Howl({src:["sound/170237__luttoaudio__glass-ting.wav"]}),blong:new Howl({src:["sound/80427__phoenixdk__ploing.wav"]})}},clean:function(_this){return function(){var j,k,len,p,ref1,ref2,results1;ref1=TouchManager.data.pos;for(j=0,len=ref1.length;j<len;j++){p=ref1[j];TouchManager.removeCircle(p.x,p.y)}p=TouchManager.data.winnerP;if(p!==void 0){TouchManager.removeCircle(p.x,p.y)}TouchManager.data.winnerP=void 0;TouchManager.data.pos=[];return TouchManager.data.availableColorIndexes=function(){results1=[];for(var k=0,ref2=colors.length;0<=ref2?k<ref2:k>ref2;0<=ref2?k++:k--){results1.push(k)}return results1}.apply(this)}}(this),cleanIfEnded:function(_this){return function(){if(TouchManager.data.winnerP!==void 0){return TouchManager.clean()}}}(this),stop:function(_this){return function(){var j,len,p,ref1;TouchManager.data.winnerP=TouchManager.data.pos.splice(Math.random()*TouchManager.data.pos.length,1)[0];ref1=TouchManager.data.pos;for(j=0,len=ref1.length;j<len;j++){p=ref1[j];TouchManager.addBackCircle(p.x,p.y)}TouchManager.data.sounds.blong.play();TouchManager.data.state.ref=void 0;TouchManager.data.state.lastChange=void 0;TouchManager.data.state.evtCount=void 0}}(this),react:function(_this){return function(changed){var delay,delta,nextPossibleEvent;if(TouchManager.data.winnerP!==void 0){return}if(TouchManager.data.pos.length>0){if(TouchManager.data.state.ref===void 0){TouchManager.data.state.ref=(new Date).getTime();TouchManager.data.state.lastChange=(new Date).getTime();TouchManager.data.state.evtCount=0}if(changed){TouchManager.data.state.lastChange=(new Date).getTime();TouchManager.data.state.evtCount=0}delta=Math.floor((new Date).getTime()-TouchManager.data.state.lastChange);if(delta>1e3*TouchManager.data.evtCountMax){TouchManager.stop()}else if(delta>1e3*TouchManager.data.state.evtCount){TouchManager.data.sounds.tong.play();TouchManager.data.state.evtCount=TouchManager.data.state.evtCount+1}nextPossibleEvent=TouchManager.data.state.lastChange+1e3*TouchManager.data.state.evtCount;delay=nextPossibleEvent-(new Date).getTime();setTimeout(TouchManager.react,delay)}else{TouchManager.data.state.ref=void 0;TouchManager.data.state.lastChange=void 0;TouchManager.data.state.evtCount=void 0}}}(this),getColor:function(_this){return function(color,a){var b,g,r;r=color[0];g=color[1];b=color[2];if(a===void 0){a=1}return"rgba("+r+","+g+","+b+","+a+")"}}(this),getBgColor:function(_this){return function(a){return TouchManager.getColor(TouchManager.data.bgColor,a)}}(this),getColorFromIndex:function(_this){return function(colorIndex,a){var color;color=colors[colorIndex%colors.length];return TouchManager.getColor(color,a)}}(this),addCircle:function(_this){return function(x,y,colorIndex){var ctx,d,dd,dwidth,dx,dy,f,j,k,ref1,ref2,width;ctx=TouchManager.data.ctx;width=TouchManager.data.width;dwidth=2*width;for(dx=j=0,ref1=dwidth;0<=ref1?j<=ref1:j>=ref1;dx=0<=ref1?++j:--j){for(dy=k=0,ref2=dwidth;0<=ref2?k<=ref2:k>=ref2;dy=0<=ref2?++k:--k){dd=(dx-width)*(dx-width)+(dy-width)*(dy-width);if(dd<width*width){d=Math.sqrt(dd/(width*width));f=1-Math.pow(1-Math.sqrt(1-d),3);ctx.fillStyle=TouchManager.getColorFromIndex(colorIndex,f);ctx.fillRect(x+dx-width,y+dy-width,1,1)}}}}}(this),addBackCircle:function(_this){return function(x,y){var ctx,d,dd,dwidth,dx,dy,f,j,k,ref1,ref2,width;ctx=TouchManager.data.ctx;width=TouchManager.data.width*(2/3);dwidth=2*width;for(dx=j=0,ref1=dwidth;0<=ref1?j<=ref1:j>=ref1;dx=0<=ref1?++j:--j){for(dy=k=0,ref2=dwidth;0<=ref2?k<=ref2:k>=ref2;dy=0<=ref2?++k:--k){dd=(dx-width)*(dx-width)+(dy-width)*(dy-width);if(dd<width*width){d=Math.sqrt(dd/(width*width));f=1-Math.pow(1-Math.sqrt(1-d),4);ctx.fillStyle=TouchManager.getBgColor(f);ctx.fillRect(x+dx-width,y+dy-width,1,1)}}}}}(this),removeCircle:function(_this){return function(x,y){var bgColor,ctx,dd,dwidth,dx,dy,j,k,ref1,ref2,width;bgColor=TouchManager.getBgColor();ctx=TouchManager.data.ctx;width=TouchManager.data.width;dwidth=2*width;for(dx=j=0,ref1=dwidth;0<=ref1?j<=ref1:j>=ref1;dx=0<=ref1?++j:--j){for(dy=k=0,ref2=dwidth;0<=ref2?k<=ref2:k>=ref2;dy=0<=ref2?++k:--k){dd=(dx-width)*(dx-width)+(dy-width)*(dy-width);if(dd<width*width){ctx.fillStyle=bgColor;ctx.fillRect(x+dx-width,y+dy-width,1,1)}}}}}(this),toogleOn:function(_this){return function(x,y){var d,j,len,nextColorIndex,p,pindex,ref1;pindex=0;TouchManager.cleanIfEnded();ref1=TouchManager.data.pos;for(j=0,len=ref1.length;j<len;j++){p=ref1[j];d=(p.x-x)*(p.x-x)+(p.y-y)*(p.y-y);if(d<50*50){TouchManager.removeCircle(p.x,p.y);TouchManager.data.pos.splice(pindex,1);TouchManager.data.availableColorIndexes.push(p.colorIndex);TouchManager.react(true);return 0}if(d<100*100){return 0}pindex+=1}if(TouchManager.data.availableColorIndexes.length>0){nextColorIndex=TouchManager.data.availableColorIndexes.splice(Math.random()*TouchManager.data.availableColorIndexes.length,1)[0];p={x:x,y:y,colorIndex:nextColorIndex};TouchManager.data.pos.push(p);TouchManager.addCircle(p.x,p.y,p.colorIndex);TouchManager.data.sounds.dzang.play();TouchManager.react(true)}}}(this),onClick:function(_this){return function(e){return TouchManager.toogleOn(e.offsetX,e.offsetY)}}(this),init:function(_this){return function(){var body,canvas,ctx,workspace;body=document.body;workspace=document.getElementById("workspace");canvas=document.createElement("canvas");workspace.appendChild(canvas);canvas.width=workspace.clientWidth;canvas.height=workspace.clientHeight;ctx=canvas.getContext("2d");ctx.fillStyle=TouchManager.getBgColor();ctx.fillRect(0,0,canvas.width,canvas.height);TouchManager.data.canvas=canvas;TouchManager.data.ctx=ctx;canvas.addEventListener("click",TouchManager.onClick,false);window.addEventListener("resize",TouchManager.clean,false);window.TouchManager=TouchManager}}(this)};TouchManager.init();